<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syyd Chess</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <style>
        :root { --bg: #161512; --panel: #262421; --accent: #45a049; --text: #bababa; }
        body { background-color: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; justify-content: center; }
        
        /* Menü Ekranı */
        #menu-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 100; }
        .menu-card { background: var(--panel); padding: 30px; border-radius: 8px; text-align: center; width: 320px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* Tahta ve Yan Paneller */
        .game-container { display: flex; flex-direction: column; align-items: center; gap: 10px; }
        #board { width: 500px; max-width: 90vw; border-radius: 3px; overflow: hidden; }
        
        /* Zamanlayıcılar (Lichess Tarzı) */
        .timer-box { width: 100%; display: flex; justify-content: space-between; align-items: center; background: var(--panel); padding: 8px 15px; border-radius: 4px; font-weight: bold; font-size: 1.2rem; box-sizing: border-box; }
        .timer { font-family: monospace; color: #fff; background: #312e2b; padding: 4px 10px; border-radius: 3px; }
        .timer.active { background: #fff; color: #000; }

        /* Butonlar */
        button { background: #363532; color: var(--text); border: none; padding: 12px 20px; border-radius: 4px; cursor: pointer; font-size: 15px; margin-top: 10px; transition: 0.2s; width: 100%; }
        button:hover { background: #403f3c; color: #fff; }
        .btn-start { background: var(--accent); color: white; font-weight: bold; margin-top: 20px; }
        
        select { background: #363532; color: white; padding: 8px; width: 100%; border: none; border-radius: 4px; margin-top: 5px; cursor: pointer; }
        
        /* Satranç Tahtası Renkleri */
        .white-1e1d7 { background-color: #dee3e6 !important; }
        .black-3b838 { background-color: #8ca2ad !important; }
    </style>
</head>
<body>

    <!-- Başlangıç Menüsü -->
    <div id="menu-overlay">
        <div class="menu-card">
            <h2 style="margin-bottom: 25px;">SYYD CHESS</h2>
            
            <label>Oyun Modu:</label>
            <select id="gameMode">
                <option value="ai">Yapay Zekaya Karşı</option>
                <option value="pvp">Arkadaşınla Oyna</option>
            </select>

            <div id="ai-settings">
                <label style="display:block; margin-top:15px;">Zorluk Seviyesi (1-10):</label>
                <select id="aiLevel">
                    <option value="1">Seviye 1 (Başlangıç)</option>
                    <option value="3">Seviye 3 (Orta)</option>
                    <option value="5">Seviye 5 (Zor)</option>
                    <option value="10">Seviye 10 (Usta)</option>
                </select>
            </div>

            <label style="display:block; margin-top:15px;">Rengini Seç:</label>
            <select id="playerSide">
                <option value="white">Beyaz</option>
                <option value="black">Siyah</option>
            </select>

            <button class="btn-start" onclick="startGame()">OYUNU BAŞLAT</button>
        </div>
    </div>

    <!-- Oyun Alanı -->
    <div class="game-container">
        <!-- Rakip Saati -->
        <div class="timer-box">
            <span id="opp-name">Rakip</span>
            <div id="timer-top" class="timer">05:00</div>
        </div>

        <div id="board"></div>

        <!-- Senin Saatin -->
        <div class="timer-box">
            <span id="my-name">Sen</span>
            <div id="timer-bottom" class="timer">05:00</div>
        </div>

        <div style="display: flex; gap: 10px; width: 100%;">
            <button onclick="board.flip()">Tahtayı Çevir</button>
            <button onclick="location.reload()">Menüye Dön</button>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

    <script>
        var board = null;
        var game = new Chess();
        var moveHistory = [];
        var timers = { w: 300, b: 300 };
        var interval = null;
        var gameConfig = { mode: 'ai', level: 1, side: 'white' };

        function startGame() {
            gameConfig.mode = $('#gameMode').val();
            gameConfig.level = $('#aiLevel').val();
            gameConfig.side = $('#playerSide').val();

            $('#menu-overlay').hide();
            
            var config = {
                draggable: true,
                position: 'start',
                orientation: gameConfig.side,
                onDragStart: onDragStart,
                onDrop: onDrop,
                pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
            };
            board = Chessboard('board', config);
            
            updateNames();
            startTimer();

            if(gameConfig.side === 'black' && gameConfig.mode === 'ai') {
                setTimeout(makeAIMove, 500);
            }
        }

        function updateNames() {
            if(gameConfig.mode === 'ai') {
                $('#opp-name').text('Stockfish (Seviye ' + gameConfig.level + ')');
                $('#my-name').text('Seyyid');
            } else {
                $('#opp-name').text('Rakip (Siyah)');
                $('#my-name').text('Seyyid (Beyaz)');
            }
        }

        function startTimer() {
            if(interval) clearInterval(interval);
            interval = setInterval(() => {
                if(game.game_over()) return clearInterval(interval);
                
                let turn = game.turn(); // 'w' or 'b'
                timers[turn]--;
                
                updateTimerDisplay();

                if(timers[turn] <= 0) {
                    alert("Zaman bitti! " + (turn === 'w' ? 'Siyah' : 'Beyaz') + " kazandı.");
                    clearInterval(interval);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            let whiteTime = formatTime(timers.w);
            let blackTime = formatTime(timers.b);

            if(board.orientation() === 'white') {
                $('#timer-top').text(blackTime).toggleClass('active', game.turn() === 'b');
                $('#timer-bottom').text(whiteTime).toggleClass('active', game.turn() === 'w');
            } else {
                $('#timer-top').text(whiteTime).toggleClass('active', game.turn() === 'w');
                $('#timer-bottom').text(blackTime).toggleClass('active', game.turn() === 'b');
            }
        }

        function formatTime(s) {
            let min = Math.floor(s / 60);
            let sec = s % 60;
            return (min < 10 ? '0' : '') + min + ":" + (sec < 10 ? '0' : '') + sec;
        }

        function onDragStart (source, piece) {
            if (game.game_over()) return false;
            // PvP modunda değilsek sadece kendi rengini oynatabilirsin
            if (gameConfig.mode === 'ai') {
                if ((gameConfig.side === 'white' && piece.search(/^b/) !== -1) ||
                    (gameConfig.side === 'black' && piece.search(/^w/) !== -1)) return false;
            }
        }

        async function makeAIMove() {
            const fen = game.fen();
            const depth = gameConfig.level; 
            
            // Stockfish API kullanımı
            try {
                const response = await fetch(`https://stockfish.online/api/s/v2.php?fen=${fen}&depth=${depth}`);
                const data = await response.json();
                if(data.success) {
                    const bestMove = data.bestmove.split(' ')[1];
                    game.move({ from: bestMove.slice(0,2), to: bestMove.slice(2,4), promotion: 'q' });
                    board.position(game.fen());
                }
            } catch (e) {
                console.error("AI Error", e);
            }
        }

        function onDrop (source, target) {
            var move = game.move({ from: source, to: target, promotion: 'q' });
            if (move === null) return 'snapback';

            if(gameConfig.mode === 'ai' && !game.game_over()) {
                window.setTimeout(makeAIMove, 250);
            }
        }

        $('#gameMode').on('change', function() {
            $('#ai-settings').toggle(this.value === 'ai');
        });
    </script>
</body>
</html>